<?xml version="1.0" encoding="UTF-8" standalone="yes"?>

<template name="Tpwr" element="pages" type="acquisition" >
  <group size="840 260"
    label="Tpwr"
    vc="amp_params('tpwrmap')"
    bg="transparent"
    border="None"
    side="Top"
    justify="Left"
    tab="yes"
    enable="no"
    reference="Tpwr"
    useref="no"
    subtype="Untitled"
    expanded="yes"
    rows="1"
    columns="1"
    >
    <group loc="475 10" size="315 205"
      style="Heading1"
      label="Attenuator Correction"
      bg="transparent"
      border="Etched"
      side="Top"
      justify="Left"
      tab="no"
      enable="no"
      reference="RFPulsePara"
      useref="no"
      subtype="Titled"
      expanded="yes"
      rows="1"
      columns="1"
      >
      <button loc="215 95" size="45 20"
        style="Heading2"
        label="Full"
        vc="tpwr3=-37 tpwr1=0"
        bg="transparent"
        decor1="yes"
        tooltip="Set default full range parameters"
        halignment="Center"
        valignment="Center"
        />
      <button loc="260 95" size="45 20"
        style="Heading2"
        label="Half"
        vc="tpwr3=0 tpwr1=20"
        bg="transparent"
        decor1="yes"
        tooltip="Validate using hardware correction"
        halignment="Center"
        valignment="Center"
        />
      <button loc="210 125" size="60 25"
        style="Heading2"
        label="Test"
        vq="tn ampargs"
        vc="mktpwrmap('test')"
        show="ampdir:$a,$b,$c,$d,$e $file=$e+'/tpwr.map' exists($file,'file'):$filex if $filex&gt;0 then $VALUE=1 else $VALUE=0 endif"
        bg="transparent"
        decor1="yes"
        tooltip="Validate using hardware correction"
        halignment="Center"
        valignment="Center"
        />
      <check loc="225 150" size="60 25"
        style="Label1"
        label="jpgs"
        vq="ampargs"
        vc="ampargs[4]=32*trunc(ampargs[4]/32)+(ampargs[4] mod 16)+16"
        vc2="ampargs[4]=32*trunc(ampargs[4]/32)+(ampargs[4] mod 16)"
        set="if((trunc(ampargs[4] /16) mod 2)=1) then $VALUE=1 else $VALUE=0 endif"
        show="$VALUE=1"
        tooltip="Generate jpg images from plots"
        />
      <entry loc="165 95" size="40 20"
        style="PlainText"
        vq="tn"
        vc="tn='$VALUE' mktpwrmap('count')"
        set="$VALUE=tn"
        disable="Grayed out"
        />
      <label loc="110 95" size="55 20"
        style="Label1"
        label="Nucleus"
        justify="Left"
        />
      <selmenu loc="50 95" size="50 20"
        style="PlainText"
        vq="ampargs"
        vc="ampargs[2] = $VALUE mktpwrmap('count')"
        set="$VALUE = ampargs[2]"
        bg="VJBackground"
        editable="No"
        >
        <mlabel 
          label="rf1"
          chval="1"
          />
        <mlabel 
          label="rf2"
          chval="2"
          />
        <mlabel 
          label="rf3"
          chval="3"
          />
        <mlabel 
          label="rf4"
          chval="4"
          />
        <mlabel 
          label="rf5"
          chval="5"
          />
      </selmenu>
      <entry loc="10 20" size="295 25"
        style="PlainText"
        vq="ampargs tn"
        set="ampdir:$a,$b,$c,$d,$VALUE"
        show="$VALUE=0"
        disable="Label"
        />
      <group loc="10 45" size="295 45"
        style="Heading2"
        label="Loopback  Configuration"
        bg="transparent"
        border="Etched"
        tab="no"
        enable="no"
        reference="Tables"
        useref="no"
        subtype="Titled"
        expanded="yes"
        rows="1"
        columns="1"
        >
        <radio loc="145 20" size="145 20"
          style="Label1"
          label="Transmitter + Amp"
          vq="ampargs"
          vc="ampargs[10]=1 amptables=1 tpwr3=0 tpwr1=20 mktpwrmap('count')"
          set="if(ampargs[10]=1) then $VALUE=1 else $VALUE=0 endif"
          tooltip="Amplifier calibration mode"
          />
        <radio loc="10 20" size="125 20"
          style="Label1"
          label="Transmitter only"
          vq="ampargs"
          vc="ampargs[10]=0 amptables=0  tpwr3=-37 tpwr1=0 mktpwrmap('count')"
          set="if(ampargs[10]=0) then $VALUE=1 else $VALUE=0 endif"
          tooltip="Tpwr calibration mode"
          />
      </group>
      <textmessage loc="75 150" size="35 25"
        style="PlainText"
        label="3"
        vq="ampargs"
        set="$VALUE=ampargs[11]"
        show="$VALUE=0"
        digits="0"
        />
      <check loc="10 150" size="70 25"
        style="Label1"
        label="Iterate"
        vq="ampargs"
        vc="ampargs[7] =1"
        vc2="ampargs[7] =0"
        set="if ampargs[7] =1 then $VALUE=1 else $VALUE=0 endif"
        show="if amptables&gt;0  then $VALUE=1 else $VALUE=0 endif"
        tooltip="Use Validation data to refine calibration tables"
        />
      <button loc="115 150" size="60 25"
        style="Heading2"
        label="Revert"
        vq="ampargs"
        vc="mktpwrmap('restore')"
        bg="transparent"
        decor1="yes"
        tooltip="Restore original map and delete validate and test files"
        halignment="Center"
        valignment="Center"
        />
      <button loc="10 125" size="65 25"
        style="Heading2"
        label="Calibrate"
        vc="mktpwrmap"
        bg="transparent"
        decor1="yes"
        tooltip="Calibrate channel Attenuators"
        halignment="Center"
        valignment="Center"
        />
      <button loc="270 125" size="30 25"
        style="Heading2"
        vq="ampargs tn"
        vc="mktpwrmap('plot_test')"
        show="ampdir:$a,$b,$c,$d,$e if ampargs[10]=1 then $type='.amp' else $type='.xmtr' endif $file=$a+'/test'+$type+'.map' exists($file,'file'):$filex if $filex&gt;0 then $VALUE=1 else $VALUE=0 endif"
        bg="transparent"
        decor1="yes"
        icon="matlabicon"
        tooltip="show attenuator error and test plots"
        halignment="Center"
        valignment="Center"
        />
      <button loc="175 125" size="30 25"
        style="Heading2"
        vq="ampargs"
        vc="mktpwrmap('plot_validate')"
        show="ampdir:$a,$b,$c,$d,$e if ampargs[10]=1 then $type='.amp' else $type='.xmtr' endif $file=$a+'/validate'+$type+'.map' exists($file,'file'):$filex if $filex&gt;0 then $VALUE=1 else $VALUE=0 endif"
        bg="transparent"
        decor1="yes"
        icon="matlabicon"
        tooltip="show selected validation plots"
        halignment="Center"
        valignment="Center"
        />
      <button loc="115 125" size="60 25"
        style="Heading2"
        label="Validate"
        vq="pwrtables ampargs"
        vc="mktpwrmap('validate')"
        show="ampdir:$a,$b,$c,$d,$e $file=$e+'/tpwr.map' exists($file,'file'):$filex if $filex&gt;0 then $VALUE=1 else $VALUE=0 endif"
        bg="transparent"
        decor1="yes"
        tooltip="Iterate using hardware correction"
        halignment="Center"
        valignment="Center"
        />
      <label loc="10 95" size="45 20"
        style="Label1"
        label="RFchnl"
        justify="Left"
        />
      <button loc="75 125" size="35 25"
        style="Heading2"
        vq="tn ampargs"
        vc="mktpwrmap('plot')"
        show="ampdir:$a,$b,$c,$d,$e $file=$a+'/tpwr.map' exists($file,'file'):$filex if $filex&gt;0 then $VALUE=1 else $VALUE=0 endif"
        bg="transparent"
        decor1="yes"
        icon="matlabicon"
        tooltip="show tpwr error plot"
        halignment="Center"
        valignment="Center"
        />
    </group>
    <group loc="245 10" size="225 205"
      style="Heading1"
      label="RF Pulses"
      bg="transparent"
      border="Etched"
      side="Top"
      justify="Left"
      tab="no"
      enable="no"
      reference="RFPulsePara"
      useref="no"
      subtype="Titled"
      expanded="yes"
      rows="1"
      columns="1"
      >
      <entry loc="75 110" size="60 20"
        style="PlainText"
        vq="tpwr3"
        vc="tpwr3=$VALUE"
        set="$VALUE=tpwr3"
        disable="Grayed out"
        tooltip="Lowest tpwr value used in calibration"
        />
      <label loc="10 150" size="60 20"
        style="Label1"
        label="tpwrf"
        justify="Left"
        />
      <label loc="10 130" size="60 20"
        style="Label1"
        label="gain"
        justify="Left"
        />
      <entry loc="75 150" size="60 20"
        style="PlainText"
        vq="tpwrf"
        vc="tpwrf=$VALUE go('check')"
        set="$VALUE=tpwrf"
        disable="Grayed out"
        tooltip="tpwrf value used in validation"
        />
      <entry loc="75 130" size="60 20"
        style="PlainText"
        vq="gain"
        vc="gain=$VALUE  go('check')"
        set="$VALUE=gain"
        disable="Grayed out"
        />
      <textmessage loc="140 110" size="75 20"
        style="PlainText"
        label="1.000"
        vq="tpwr3 tpwrf"
        set="calc_power(tpwr3,tpwrf):$dum,$VALUE"
        digits="3"
        />
      <textmessage loc="140 90" size="75 20"
        style="PlainText"
        label="10.0"
        vq="tpwr1 tpwrf"
        set="calc_power(tpwr1,tpwrf):$dum,$VALUE"
        digits="1"
        />
      <textmessage loc="140 70" size="75 20"
        style="PlainText"
        label="1,412.5"
        vq="tpwr2 tpwrf"
        set="calc_power(tpwr2,tpwrf):$dum,$VALUE"
        digits="1"
        />
      <label loc="5 90" size="55 20"
        style="Label1"
        label="Mid tpwr"
        justify="Left"
        />
      <entry loc="75 90" size="60 20"
        style="PlainText"
        vq="tpwr1"
        vc="tpwr1=$VALUE go('check')"
        set="$VALUE=tpwr1"
        disable="Grayed out"
        tooltip="Mid-point tpwr value used in calibration"
        />
      <entry loc="75 70" size="60 20"
        style="PlainText"
        vq="tpwr2"
        vc="tpwr2=$VALUE go('check')"
        set="$VALUE=tpwr2"
        disable="Grayed out"
        tooltip="Maximum tpwr value used in calibration"
        />
      <label loc="5 70" size="55 20"
        style="Label1"
        label="Max tpwr"
        justify="Left"
        />
      <label loc="5 110" size="55 20"
        style="Label1"
        label="Min tpwr"
        justify="Left"
        />
      <entry loc="75 50" size="60 20"
        style="PlainText"
        vq="p1pat"
        vc="p1pat='$VALUE' go('check')"
        set="$VALUE=p1pat"
        disable="Grayed out"
        tooltip="calibration shaped pulse"
        />
      <label loc="10 50" size="65 20"
        style="Label1"
        label="Shape"
        justify="Left"
        />
      <label loc="145 30" size="25 20"
        style="Label1"
        label="us"
        justify="Left"
        />
      <entry loc="75 30" size="60 20"
        style="PlainText"
        vq="p1"
        vc="p1=$VALUE go('check')"
        set="$VALUE=p1"
        digits="1"
        disable="Grayed out"
        tooltip="width of pulse shape"
        />
      <label loc="10 30" size="65 20"
        style="Label1"
        label="Width"
        justify="Left"
        />
    </group>
    <group loc="0 10" size="240 205"
      style="Heading1"
      label="Scan Parameters"
      bg="transparent"
      border="Etched"
      side="Top"
      justify="Left"
      tab="no"
      enable="no"
      reference="trstuff"
      useref="no"
      subtype="Titled"
      expanded="yes"
      rows="1"
      columns="1"
      >
      <label loc="10 170" size="30 20"
        style="Label1"
        label="sfrq"
        justify="Left"
        />
      <label loc="180 175" size="30 20"
        style="Label1"
        label="MHz"
        justify="Left"
        />
      <entry loc="100 175" size="60 20"
        style="PlainText"
        vq="sfrq tn"
        vc="sfrq=$VALUE go('check')"
        set="$VALUE=sfrq"
        digits="2"
        disable="Grayed out"
        />
      <entry loc="100 70" size="60 20"
        style="PlainText"
        vq="ddrfw1 sw"
        vc="ddrfw1=$VALUE/sw"
        set="$VALUE=ddrfw1*sw"
        disable="Grayed out"
        />
      <label loc="180 70" size="30 20"
        style="Label1"
        label="Hz"
        justify="Left"
        />
      <label loc="10 70" size="80 20"
        style="Label1"
        label="Filter"
        justify="Left"
        />
      <label loc="180 90" size="30 20"
        style="Label1"
        label="Hz"
        justify="Left"
        />
      <entry loc="100 90" size="60 20"
        style="PlainText"
        vq="sw"
        vc="sw=$VALUE go('check')"
        set="$VALUE=sw"
        disable="Grayed out"
        />
      <label loc="10 90" size="80 20"
        style="Label1"
        label="sw"
        justify="Left"
        />
      <label loc="180 110" size="30 20"
        style="Label1"
        label="ms"
        justify="Left"
        />
      <entry loc="100 110" size="60 20"
        style="PlainText"
        vq="at"
        vc="at=$VALUE/1000.0 go('check')"
        set="$VALUE=at*1000.0"
        digits="3"
        disable="Grayed out"
        />
      <label loc="10 110" size="80 20"
        style="Label1"
        label="at"
        justify="Left"
        />
      <entry loc="100 130" size="60 20"
        style="PlainText"
        vq="np"
        vc="np=$VALUE go('check')"
        set="$VALUE=np"
        digits="0"
        disable="Grayed out"
        />
      <label loc="10 130" size="80 20"
        style="Label1"
        label="np"
        justify="Left"
        />
      <entry loc="100 150" size="60 20"
        style="PlainText"
        vq="ss"
        vc="ss=-$VALUE"
        set="$VALUE=-ss"
        digits="0"
        disable="Grayed out"
        />
      <label loc="10 150" size="80 20"
        style="Label1"
        label="ss"
        justify="Left"
        />
      <entry loc="100 50" size="60 20"
        style="PlainText"
        vq="nt"
        vc="nt=$VALUE  go('check')"
        set="$VALUE=nt"
        disable="Grayed out"
        />
      <entry loc="100 30" size="60 20"
        style="PlainText"
        vq="tr mintr"
        vc="tr=$VALUE/1000.0 go('check')"
        set="$VALUE=tr*1000.0"
        digits="2"
        disable="Grayed out"
        />
      <label loc="10 30" size="80 20"
        style="Label1"
        label="Rep. Delay"
        justify="Left"
        />
      <label loc="180 30" size="30 20"
        style="Label1"
        label="ms"
        justify="Left"
        />
      <label loc="10 50" size="80 20"
        style="Label1"
        label="Repetitions"
        justify="Left"
        />
    </group>
  </group>
</template>
