<?xml version="1.0" encoding="UTF-8" standalone="yes"?>

<template name="Amps" element="pages" type="acquisition" >
  <group size="865 260"
    label="Amps"
    vc="amp_params('fidelity')"
    bg="transparent"
    border="None"
    side="Top"
    justify="Left"
    tab="yes"
    enable="no"
    reference="Amps"
    useref="no"
    subtype="Untitled"
    expanded="yes"
    rows="1"
    columns="1"
    >
    <group loc="250 10" size="220 205"
      style="Heading1"
      label="RF Pulses"
      bg="transparent"
      border="Etched"
      side="Top"
      justify="Left"
      tab="no"
      enable="no"
      reference="RFPulsePara"
      useref="no"
      subtype="Titled"
      expanded="yes"
      rows="1"
      columns="1"
      >
      <textmessage loc="145 70" size="65 20"
        style="PlainText"
        vq="tpwr1 tpwrf"
        set="calc_power(tpwr1,tpwrf):$dum,$VALUE"
        digits="1"
        />
      <textmessage loc="145 90" size="65 20"
        style="PlainText"
        vq="tpwr2 tpwrf"
        set="calc_power(tpwr2,tpwrf):$dum,$VALUE"
        digits="1"
        />
      <entry loc="75 130" size="60 20"
        style="PlainText"
        vq="tpwrf"
        vc="tpwrf=$VALUE go('check')"
        set="$VALUE=tpwrf"
        disable="Grayed out"
        tooltip="tpwrf value used in validation"
        />
      <label loc="10 130" size="60 20"
        style="Label1"
        label="tpwrf"
        justify="Left"
        />
      <entry loc="75 110" size="60 20"
        style="PlainText"
        vq="gain"
        vc="gain=$VALUE  go('check')"
        set="$VALUE=gain"
        disable="Grayed out"
        />
      <label loc="10 110" size="60 25"
        style="Label1"
        label="gain"
        justify="Left"
        />
      <entry loc="75 90" size="60 20"
        style="PlainText"
        vq="tpwr2"
        vc="tpwr2=$VALUE go('check')"
        set="$VALUE=tpwr2"
        disable="Grayed out"
        tooltip="Maximum tpwr value used in calibration"
        />
      <label loc="10 90" size="55 20"
        style="Label1"
        label="tpwr2"
        justify="Left"
        />
      <entry loc="75 70" size="60 20"
        style="PlainText"
        vq="tpwr1"
        vc="tpwr1=$VALUE go('check')"
        set="$VALUE=tpwr1"
        disable="Grayed out"
        tooltip="Reference tpwr value used in calibration"
        />
      <label loc="10 70" size="55 20"
        style="Label1"
        label="tpwr1"
        justify="Left"
        />
      <entry loc="75 50" size="60 20"
        style="PlainText"
        vq="p1pat"
        vc="p1pat='$VALUE' go('check')"
        set="$VALUE=p1pat"
        disable="Grayed out"
        tooltip="calibration shaped pulse"
        />
      <label loc="10 50" size="65 20"
        style="Label1"
        label="Shape"
        justify="Left"
        />
      <label loc="145 30" size="25 20"
        style="Label1"
        label="us"
        justify="Left"
        />
      <entry loc="75 30" size="60 20"
        style="PlainText"
        vq="p1"
        vc="p1=$VALUE go('check')"
        set="$VALUE=p1"
        digits="1"
        disable="Grayed out"
        tooltip="width of pulse shape"
        />
      <label loc="10 30" size="65 20"
        style="Label1"
        label="Width"
        justify="Left"
        />
    </group>
    <group loc="5 10" size="240 205"
      style="Heading1"
      label="Scan Parameters"
      bg="transparent"
      border="Etched"
      side="Top"
      justify="Left"
      tab="no"
      enable="no"
      reference="trstuff"
      useref="no"
      subtype="Titled"
      expanded="yes"
      rows="1"
      columns="1"
      >
      <label loc="10 170" size="30 20"
        style="Label1"
        label="sfrq"
        justify="Left"
        />
      <label loc="180 175" size="30 20"
        style="Label1"
        label="MHz"
        justify="Left"
        />
      <entry loc="100 175" size="60 20"
        style="PlainText"
        vq="sfrq tn"
        vc="sfrq=$VALUE go('check')"
        set="$VALUE=sfrq"
        digits="2"
        disable="Grayed out"
        />
      <entry loc="100 70" size="60 20"
        style="PlainText"
        vq="ddrfw1 sw"
        vc="ddrfw1=$VALUE/sw"
        set="$VALUE=ddrfw1*sw"
        disable="Grayed out"
        />
      <label loc="180 70" size="30 20"
        style="Label1"
        label="Hz"
        justify="Left"
        />
      <label loc="10 70" size="80 20"
        style="Label1"
        label="Filter"
        justify="Left"
        />
      <label loc="180 90" size="30 20"
        style="Label1"
        label="Hz"
        justify="Left"
        />
      <entry loc="100 90" size="60 20"
        style="PlainText"
        vq="sw"
        vc="sw=$VALUE go('check')"
        set="$VALUE=sw"
        disable="Grayed out"
        />
      <label loc="10 90" size="80 20"
        style="Label1"
        label="sw"
        justify="Left"
        />
      <label loc="180 110" size="30 20"
        style="Label1"
        label="ms"
        justify="Left"
        />
      <entry loc="100 110" size="60 20"
        style="PlainText"
        vq="at"
        vc="at=$VALUE/1000.0 go('check')"
        set="$VALUE=at*1000.0"
        digits="3"
        disable="Grayed out"
        />
      <label loc="10 110" size="80 20"
        style="Label1"
        label="at"
        justify="Left"
        />
      <entry loc="100 130" size="60 20"
        style="PlainText"
        vq="np"
        vc="np=$VALUE go('check')"
        set="$VALUE=np"
        digits="0"
        disable="Grayed out"
        />
      <label loc="10 130" size="80 20"
        style="Label1"
        label="np"
        justify="Left"
        />
      <entry loc="100 150" size="60 20"
        style="PlainText"
        vq="ss"
        vc="ss=-$VALUE"
        set="$VALUE=-ss"
        digits="0"
        disable="Grayed out"
        />
      <label loc="10 150" size="80 20"
        style="Label1"
        label="ss"
        justify="Left"
        />
      <entry loc="100 50" size="60 20"
        style="PlainText"
        vq="nt"
        vc="nt=$VALUE  go('check')"
        set="$VALUE=nt"
        disable="Grayed out"
        />
      <entry loc="100 30" size="60 20"
        style="PlainText"
        vq="tr mintr"
        vc="tr=$VALUE/1000.0 go('check')"
        set="$VALUE=tr*1000.0"
        digits="2"
        disable="Grayed out"
        />
      <label loc="10 30" size="80 20"
        style="Label1"
        label="Rep. Delay"
        justify="Left"
        />
      <label loc="180 30" size="30 20"
        style="Label1"
        label="ms"
        justify="Left"
        />
      <label loc="10 50" size="80 20"
        style="Label1"
        label="Repetitions"
        justify="Left"
        />
    </group>
    <group loc="475 10" size="375 205"
      style="Heading1"
      label="Correction"
      bg="transparent"
      border="Etched"
      side="Top"
      justify="Left"
      tab="no"
      enable="no"
      reference="RFPulsePara"
      useref="no"
      subtype="Titled"
      expanded="yes"
      rows="1"
      columns="1"
      >
      <button loc="70 125" size="35 25"
        style="Heading2"
        vq="ampargs"
        vc="fidelityFit('plot_calibrate')"
        bg="transparent"
        decor1="yes"
        icon="matlabicon"
        tooltip="show selected calibration plots"
        halignment="Center"
        valignment="Center"
        />
      <button loc="5 125" size="65 25"
        style="Heading2"
        label="Calibrate"
        vc="fidelityFit('calibrate')"
        show="$VALUE=1"
        bg="transparent"
        decor1="yes"
        tooltip="Calibrate Amplifier channel"
        halignment="Center"
        valignment="Center"
        />
      <entry loc="10 20" size="360 25"
        style="PlainText"
        vq="ampargs tn"
        set="ampdir:$VALUE"
        show="$VALUE=0"
        disable="Label"
        />
      <group loc="5 150" size="285 50"
        style="Heading2"
        label="Plot"
        bg="transparent"
        border="Etched"
        tab="no"
        enable="no"
        reference="Figures"
        useref="no"
        subtype="Titled"
        expanded="yes"
        rows="1"
        columns="1"
        >
        <check loc="51 20" size="50 25"
          style="Label1"
          label="raw"
          vq="ampargs"
          vc="ampargs[4]=4*trunc(ampargs[4]/4)+(ampargs[4] mod 2)+2"
          vc2="ampargs[4]=4*trunc(ampargs[4]/4)+(ampargs[4] mod 2)"
          set="if( trunc(ampargs[4] /2) mod 2=1) then $VALUE=1 else $VALUE=0 endif"
          tooltip="Show Raw Data Plots"
          />
        <check loc="11 20" size="45 25"
          style="Label1"
          label="fit"
          vq="ampargs"
          vc="ampargs[4]=2*trunc(ampargs[4]/2)+1"
          vc2="ampargs[4]=2*trunc(ampargs[4]/2)"
          set="if((ampargs[4] mod 2)=1) then $VALUE=1 else $VALUE=0 endif"
          tooltip="Show Data Analysis Plots"
          />
        <check loc="103 20" size="65 25"
          style="Label1"
          label="shape"
          vq="ampargs"
          vc="ampargs[4]=8*trunc(ampargs[4]/8)+(ampargs[4] mod 4)+4"
          vc2="ampargs[4]=8*trunc(ampargs[4]/8)+(ampargs[4] mod 4)"
          set="if( trunc(ampargs[4] /4) mod 2=1) then $VALUE=1 else $VALUE=0 endif"
          tooltip="Show predicted shape correction"
          />
        <check loc="168 20" size="60 25"
          style="Label1"
          label="tables"
          vq="ampargs"
          vc="ampargs[4]=16*trunc(ampargs[4]/16)+(ampargs[4] mod 8)+8"
          vc2="ampargs[4]=16*trunc(ampargs[4]/16)+(ampargs[4] mod 8)"
          set="if( trunc(ampargs[4] /8) mod 2=1) then $VALUE=1 else $VALUE=0 endif"
          tooltip="Show tpwr calibration tables"
          />
        <check loc="233 20" size="50 25"
          style="Label1"
          label="jpgs"
          vq="ampargs"
          vc="ampargs[4]=32*trunc(ampargs[4]/32)+(ampargs[4] mod 16)+16"
          vc2="ampargs[4]=32*trunc(ampargs[4]/32)+(ampargs[4] mod 16)"
          set="if((trunc(ampargs[4] /16) mod 2)=1) then $VALUE=1 else $VALUE=0 endif"
          show="$VALUE=1"
          tooltip="Generate jpg images from plots"
          />
      </group>
      <group loc="250 50" size="120 45"
        style="Heading2"
        label="Target Mode"
        bg="transparent"
        border="Etched"
        tab="no"
        enable="no"
        reference="Tables"
        useref="no"
        subtype="Titled"
        expanded="yes"
        rows="1"
        columns="1"
        >
        <radio loc="60 20" size="55 20"
          style="Label1"
          label="slope"
          vq="ampargs"
          vc="ampargs[6]=1"
          set="if(ampargs[6]=1) then $VALUE=1 else $VALUE=0 endif"
          tooltip="Minimun Slope"
          />
        <radio loc="5 20" size="55 20"
          style="Label1"
          label="ymax"
          vq="ampargs"
          vc="ampargs[6]=0"
          set="if(ampargs[6]=0) then $VALUE=1 else $VALUE=0 endif"
          tooltip="Maximum Value"
          />
      </group>
      <button loc="195 125" size="30 25"
        style="Heading2"
        vq="ampargs"
        vc="fidelityFit('plot_validate')"
        bg="transparent"
        decor1="yes"
        icon="matlabicon"
        tooltip="show selected validation plots"
        halignment="Center"
        valignment="Center"
        />
      <button loc="135 125" size="60 25"
        style="Heading2"
        label="Validate"
        vq="amptables ampargs"
        vc="fidelityFit('validate')"
        show="if amptables&gt;0  then $VALUE=1 else $VALUE=0 endif"
        bg="transparent"
        decor1="yes"
        tooltip="Validate using hardware correction"
        halignment="Center"
        valignment="Center"
        />
      <group loc="5 50" size="120 45"
        style="Heading2"
        label="Tables"
        bg="transparent"
        border="Etched"
        tab="no"
        enable="no"
        reference="Tables"
        useref="no"
        subtype="Titled"
        expanded="yes"
        rows="1"
        columns="1"
        >
        <radio loc="60 20" size="55 20"
          style="Label1"
          label="vnmr"
          vq="ampargs"
          vc="ampargs[1]=1"
          set="if(ampargs[1]=1) then $VALUE=1 else $VALUE=0 endif"
          tooltip="Save tables in system directory (must have write access)"
          />
        <radio loc="10 20" size="50 20"
          style="Label1"
          label="user"
          vq="ampargs"
          vc="ampargs[1]=0"
          set="if(ampargs[1]=0) then $VALUE=1 else $VALUE=0 endif"
          tooltip="Save tables in user directory "
          />
      </group>
      <label loc="15 100" size="45 20"
        style="Label1"
        label="RFchnl"
        justify="Left"
        />
      <button loc="295 180" size="70 20"
        style="Heading2"
        label="Remove"
        vq="ampargs"
        vc="fidelityFit('uninstall')"
        show="exists(systemdir+'/amptables','file','rw'):$canwrite if($canwrite&gt;0) then $VALUE=1 else $VALUE=-1 endif"
        bg="transparent"
        decor1="yes"
        tooltip="Uninstall linearization data"
        halignment="Center"
        valignment="Center"
        />
      <button loc="295 160" size="70 20"
        style="Heading2"
        label="Install"
        vq="ampargs"
        vc="fidelityFit('install')"
        show="exists(systemdir,'file','rw'):$canwrite if($canwrite&gt;0) then $VALUE=1 else $VALUE=-1 endif"
        bg="transparent"
        decor1="yes"
        tooltip="Copy linearization data  to /vnmr "
        halignment="Center"
        valignment="Center"
        />
      <group loc="125 50" size="125 45"
        style="Heading2"
        label="Fit Method"
        bg="transparent"
        border="Etched"
        tab="no"
        enable="no"
        reference="Tables"
        useref="no"
        subtype="Titled"
        expanded="yes"
        rows="1"
        columns="1"
        >
        <radio loc="5 20" size="60 20"
          style="Label1"
          label="spline"
          vq="ampargs"
          vc="ampargs[3]=0"
          set="if(ampargs[3]=0) then $VALUE=1 else $VALUE=0 endif"
          tooltip="Piecewise Quadratic spline"
          />
        <radio loc="70 20" size="55 20"
          style="Label1"
          label="poly"
          vq="ampargs"
          vc="ampargs[3]=1"
          set="if(ampargs[3]=1) then $VALUE=1 else $VALUE=0 endif"
          tooltip="Single Polynomial"
          />
      </group>
      <check loc="230 100" size="55 25"
        style="Label1"
        label="HP"
        vq="hipwrampenable ampargs"
        vc="ampargs[5] =1"
        vc2="ampargs[5] =0"
        set="if ampargs[5] =1 then $VALUE=1 else $VALUE=0 endif"
        show="exists('hipwrampenable','parameter','global'):$e if($e=1) then $VALUE=1 else $VALUE=-1 endif"
        tooltip="Use High Power Amp Tables"
        />
      <check loc="290 100" size="70 25"
        style="Label1"
        label="Iterate"
        vq="ampargs"
        vc="ampargs[7] =1"
        vc2="ampargs[7] =0"
        set="if ampargs[7] =1 then $VALUE=1 else $VALUE=0 endif"
        show="if amptables&gt;0  then $VALUE=1 else $VALUE=0 endif"
        tooltip="Use Validation data to refine calibration tables"
        />
      <button loc="255 125" size="70 25"
        style="Heading2"
        label="Test"
        vq="amptables"
        vc="fidelityFit('test')"
        show=" if amptables&gt;0  then $VALUE=1 else $VALUE=0 endif"
        bg="transparent"
        decor1="yes"
        tooltip="Test Linearization"
        halignment="Center"
        valignment="Center"
        />
      <button loc="325 125" size="30 25"
        style="Heading2"
        vq="ampargs"
        vc="fidelityFit('plot_test')"
        decor1="yes"
        icon="matlabicon"
        tooltip="show selected test plots"
        halignment="Center"
        valignment="Center"
        />
      <label loc="120 100" size="55 20"
        style="Label1"
        label="Nucleus"
        justify="Left"
        />
      <entry loc="180 100" size="40 20"
        style="PlainText"
        vq="tn"
        vc="tn='$VALUE'"
        set="$VALUE=tn"
        disable="Grayed out"
        />
      <selmenu loc="65 100" size="50 20"
        style="PlainText"
        vq="ampargs"
        vc="ampargs[2] = $VALUE'"
        set="$VALUE = ampargs[2]"
        bg="VJBackground"
        editable="No"
        >
        <mlabel 
          label="rf1"
          chval="1"
          />
        <mlabel 
          label="rf2"
          chval="2"
          />
        <mlabel 
          label="rf3"
          chval="3"
          />
        <mlabel 
          label="rf4"
          chval="4"
          />
        <mlabel 
          label="rf5"
          chval="5"
          />
      </selmenu>
    </group>
  </group>
</template>
