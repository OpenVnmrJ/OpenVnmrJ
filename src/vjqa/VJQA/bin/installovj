#!/bin/bash

# Installs the latest VnmrJ cd
# Usage: vjinstall [password:all] or vjinstall [password:Diffusion,STARS...]

set -x
userId=`/usr/bin/id | awk 'BEGIN { FS = " " } { print $1 }'`
if [ $userId != "uid=0(root)" ]
then
    echo "User must be root to install VnmrJ"
    exit 0
fi

password=''

log="../logs/logVJinstall"$(date '+_%m-%d-%y')
dir=$(dirname "$(readlink -f $0)")
cd $dir

xhost +
vnmrNoPostAction="TRUE"
export vnmrNoPostAction


if [[ $# = 1 ]]; then
   dvd=$1
else
   dvd=$(dirname $dir)
   dvd=$(dirname $dvd)
   dvd=$(dirname $dvd)
   dvd=$(dirname $dvd)
   dvd=${dvd}"/ovjbuild"
fi
if [[ -d $dvd"/dvdimageOVJ" ]]; then
   dvd=$dvd"/dvdimageOVJ"
elif [[ -d $dvd"/dvdimageOVJMI" ]]; then
   dvd=$dvd"/dvdimageOVJMI"
elif [[ -d $dvd"/dvdimageB12" ]]; then
   dvd=$dvd"/dvdimageB12"
else
   echo "No dvdimage found at ${dvd}"
   exit 0
fi

# LoadNmrDir calls 'netbeans installvj' to install the latest cd
strace -f -s 128 ${dvd}"/code/jre.linux/bin/java" -Dvnmrcd=$dvd -Dinstalltype=" inova" -cp lib/vjunit.jar LoadNmrDir $password &> $log
