<?xml version="1.0" encoding="UTF-8" standalone="yes"?>

<template name="GradientShim" element="pages" type="acquisition" >
  <group size="720 260"
    style="PlainText"
    label="Gradient Shim"
    vq="panellevel"
    show="$SHOW=(panellevel&gt;29)"
    border="None"
    side="Top"
    justify="Left"
    tab="yes"
    enable="no"
    reference="GradientShim"
    useref="no"
    subtype="Untitled"
    expanded="yes"
    rows="1"
    columns="1"
    >
    <group loc="5 0" size="210 255"
      style="Heading1"
      label="Gradient Shim Setup"
      border="Etched"
      side="Top"
      justify="Left"
      tab="no"
      enable="no"
      useref="no"
      subtype="Titled"
      rows="1"
      columns="1"
      >
      <button loc="118 180" size="85 20"
        style="Heading2"
        label="Define band"
        vq="shaped"
        vc="setgmaptof"
        show="$ENABLE=(shaped='y')*2-1"
        bg="transparent"
        decor1="no"
        halignment="Center"
        valignment="Center"
        />
      <check loc="7 180" size="119 21"
        style="PlainText"
        label="Shaped pulses"
        vq="shaped"
        vc="exists('shaped','parameter'):$shapedex if not $shapedex then create('shaped','flag') shaped='y' endif exists('shapename90','parameter'):$e if not $e then setgmapshapes endif shaped='y' "
        vc2="shaped='n'"
        set="$VALUE=(shaped='y')"
        />
      <check loc="7 157" size="145 20"
        style="Label1"
        label="Shim z1-z4 first"
        vq="gmap_z1z4"
        vc="gmap_z1z4='y'"
        vc2="gmap_z1z4='n'"
        set="$VALUE=(gmap_z1z4='y')"
        />
      <group loc="38 136" size="145 20"
        border="None"
        side="Top"
        justify="Left"
        tab="no"
        enable="no"
        useref="no"
        subtype="Untitled"
        rows="1"
        columns="1"
        >
        <textmessage loc="95 0" size="45 20"
          style="PlainText"
          label="nnc"
          vq="gradtype tmpgradtype"
          set="$VALUE=gradtype exists('tmpgradtype','parameter'):$e if ($e) then $VALUE=tmpgradtype endif"
          />
        <label loc="0 0" size="95 20"
          style="Label1"
          label="Gradient Type:"
          justify="Left"
          />
      </group>
      <group loc="10 95" size="195 40"
        style="Heading1"
        border="None"
        side="Top"
        justify="Left"
        tab="no"
        enable="no"
        useref="no"
        subtype="Untitled"
        rows="1"
        columns="1"
        >
        <button loc="75 20" size="115 20"
          style="Heading2"
          label="Homospoil H2"
          vc="gmapsys('setHSforH2')"
          halignment="Center"
          valignment="Center"
          />
        <button loc="75 0" size="115 20"
          style="Heading2"
          label="Homospoil H1"
          vc="gmapsys('setHSforH1')"
          halignment="Center"
          valignment="Center"
          />
        <button loc="0 20" size="75 20"
          style="Heading2"
          label="PFG H2"
          vc="gmapsys('setH2')"
          halignment="Center"
          valignment="Center"
          />
        <button loc="0 0" size="75 20"
          style="Heading2"
          label="PFG H1"
          vc="gmapsys('setH1')"
          halignment="Center"
          valignment="Center"
          />
      </group>
      <label loc="10 75" size="170 20"
        style="Label1"
        label="Set Acquisition Parameters:"
        justify="Left"
        />
      <menu loc="10 205" size="190 20"
        style="PlainText"
        label="menu"
        vq="vtcomplvl"
        vc="vtcomplvl=$VALUE gmapsys('checkvtcomplvl') dps"
        set="$VALUE=vtcomplvl"
        editable="No"
        >
        <mlabel 
          label="Temp compensation off"
          chval="0"
          />
        <mlabel 
          label="Temp compensation on"
          chval="1"
          />
        <mlabel 
          label="Temp compensation plus"
          chval="2"
          />
      </menu>
      <menu loc="10 225" size="190 20"
        style="PlainText"
        label="menu"
        vq="gmapspin"
        vc="gmapspin='$VALUE' if gmapspin='y' then gmapsys('spinon') else gmapsys('spinoff') endif"
        set="$VALUE=gmapspin"
        editable="No"
        >
        <mlabel 
          label="Ignore spinner"
          chval="n"
          />
        <mlabel 
          label="Synch with spinner"
          chval="y"
          />
      </menu>
      <button loc="10 25" size="190 45"
        style="Heading2"
        label="Acquire Trial Spectra"
        vc="gmapsys('au')"
        halignment="Center"
        valignment="Center"
        />
    </group>
    <group loc="220 0" size="255 255"
      style="Heading1"
      label="Make Shimmap"
      border="Etched"
      side="Top"
      justify="Left"
      tab="no"
      enable="no"
      useref="no"
      subtype="Titled"
      rows="1"
      columns="1"
      >
      <label loc="10 115" size="70 20"
        style="Heading1"
        label="Load map:"
        justify="Left"
        />
      <entry loc="10 95" size="235 20"
        style="PlainText"
        vq="seqfil gmapname"
        vc="$n='' $n='$VALUE' $m='' substr($n,1,1):$m if ($n='none' or $n='' or $m=' ') then write('error','Cannot set mapname to `%s`.',$n) vnmrjcmd('pnew','gmapname') else gmapset('mkdir',2) gmaplistfunc('wrshimcal',$n) gmapname=$n gmapsys('filemenu') endif"
        set="gmapshim('mapname',''):$VALUE"
        disable="Grayed out"
        />
      <label loc="125 160" size="80 20"
        style="Label1"
        label="Window Size"
        justify="Center"
        />
      <button loc="125 205" size="120 20"
        style="Heading2"
        label="Find Frequency"
        vc="gmapsys('findtof')"
        halignment="Center"
        valignment="Center"
        />
      <button loc="10 225" size="235 20"
        style="Heading2"
        label="Make Shimmap Using Current Settings"
        vc="gmapsys('shimmap','askmap')"
        halignment="Center"
        valignment="Center"
        />
      <button loc="10 205" size="115 20"
        style="Heading2"
        label="Find Window"
        vc="gmapsys('findgzwin')"
        halignment="Center"
        valignment="Center"
        />
      <button loc="10 185" size="235 20"
        style="Heading2"
        label="Set Window from Cursors"
        vc="gmapsys('calcgzwin')"
        halignment="Center"
        valignment="Center"
        />
      <entry loc="205 160" size="40 20"
        style="PlainText"
        vq="gzwin"
        vc="gzwin=$VALUE"
        set="$VALUE=gzwin"
        digits="1"
        disable="Grayed out"
        />
      <entry loc="95 160" size="30 20"
        style="PlainText"
        vq="gzsize"
        vc="gzsize=$VALUE"
        set="$VALUE=gzsize"
        digits="0"
        disable="Grayed out"
        />
      <label loc="10 160" size="85 20"
        style="Label1"
        label="# Shims Used"
        justify="Left"
        />
      <button loc="10 25" size="235 45"
        style="Heading2"
        label="Automake Shimmap"
        vq="shaped"
        vc="gmapsys('shimmap','ask')"
        show="exists('shaped','parameter'):$shapedex if ($shapedex) then if (shaped='y') then $ENABLE=0 else $ENABLE=1 endif else $ENABLE=1 endif"
        bg="transparent"
        halignment="Center"
        valignment="Center"
        />
      <button loc="160 75" size="85 20"
        style="Heading2"
        label="Set by date"
        vc="cqgmap('makemapname') gmapsys('filemenu') seqfil=seqfil"
        halignment="Center"
        valignment="Center"
        />
      <filemenu loc="10 135" size="235 20"
        style="PlainText"
        vq="gmapname"
        vc="$v='' $v='$VALUE' if $v='none' then vnmrjcmd('pnew','gmapname') else gmapname=$v gmapz($v) endif"
        set="$n='' $e=0 gmapshim('mapname',''):$n,$e if $e=1 then $VALUE=$n else $VALUE='none' endif"
        file="$VALUE=userdir+'/persistence/gmapshim'"
        type="file"
        bg="VJBackground"
        editable="No"
        vq2="gmapname"
        statshow="yes"
        elastic="no"
        display="yes"
        />
      <label loc="10 75" size="115 20"
        style="Label1"
        label="Current mapname:"
        justify="Left"
        />
    </group>
    <group loc="480 0" size="220 255"
      style="Heading1"
      label="Gradient Autoshim"
      border="Etched"
      side="Top"
      justify="Left"
      tab="no"
      enable="no"
      useref="no"
      subtype="Titled"
      rows="1"
      columns="1"
      >
      <button loc="10 200" size="200 20"
        style="Heading2"
        label="Add mapname into Gmap list"
        vq="probe_ probe"
        vc="Gmaplist('addmapname') Gmaplist"
        show="exists('probe_','parameter'):$parex if ($parex=0) then $ENABLE=0 else $ENABLE=(probe=probe_) endif"
        halignment="Center"
        valignment="Center"
        />
      <button loc="10 180" size="200 20"
        style="Heading2"
        label="Set mapname into probe file"
        vc="cqgmap('setprobemapname')"
        halignment="Center"
        valignment="Center"
        />
      <button loc="10 155" size="80 20"
        style="Heading2"
        label="Plot Fit"
        vc="gmaprep('explmenu','pfit')"
        halignment="Center"
        valignment="Center"
        />
      <button loc="90 155" size="120 20"
        style="Heading2"
        label="Plot Shimmap"
        vc="gmaprep('explmenu','pbase')"
        halignment="Center"
        valignment="Center"
        />
      <button loc="90 135" size="120 20"
        style="Heading2"
        label="Display Shimmap"
        vc="gmaprep('explmenu','ebase')"
        bg="transparent"
        halignment="Center"
        valignment="Center"
        />
      <button loc="10 135" size="80 20"
        style="Heading2"
        label="Display Fit"
        vc="gmaprep('explmenu','efit')"
        halignment="Center"
        valignment="Center"
        />
      <button loc="10 80" size="200 45"
        style="Heading2"
        label="Quit Gradient Autoshim"
        vc="gmapsys('exit') newdg"
        halignment="Center"
        valignment="Center"
        />
      <button loc="10 25" size="200 45"
        style="Heading2"
        label="Gradient Autoshim on Z"
        vc="gmapauto('startshim')"
        halignment="Center"
        valignment="Center"
        />
      <button loc="10 225" size="200 20"
        style="Heading2"
        label="Reset Shims"
        vc="gmapshims('unarray') rts(userdir+'/gshimlib/data/gshim.startshims') setallshims"
        halignment="Center"
        valignment="Center"
        />
    </group>
  </group>
</template>
