<?xml version="1.0" encoding="UTF-8" standalone="yes"?>

<template name="CRAFT" element="pages" type="processing" >
  <group size="780 270"
    style="Heading1"
    label="CRAFT NMR"
    vq="personaType"
    show="$S=1 PersonaManager('showInPanel','process','craft'):$S exists('craft','maclib'):$M $SHOW=($S and $M)"
    border="None"
    side="Top"
    justify="Left"
    tab="yes"
    enable="no"
    reference="CRAFT"
    useref="no"
    subtype="Untitled"
    expanded="yes"
    rows="1"
    columns="1"
    >
    <textfile loc="395 40" size="350 210"
      style="StdPar"
      vq="craftllTable curexp craftpath"
      set="exists('craftpath','parameter'):$P2 exists('craftllTable','parameter'):$P $f=curexp+'/craftll.txt' exists($f,'file'):$ex if not $P or not $P2 or not $ex then write('reset',$f) endif $VALUE=$f"
      editable="no"
      wrap="no"
      units="char"
      />
    <group loc="5 5" size="190 155"
      style="Heading1"
      label="CRAFT LineList"
      border="Etched"
      side="Top"
      justify="Left"
      tab="no"
      enable="no"
      reference="Datamanipulation"
      useref="no"
      subtype="Titled"
      expanded="yes"
      rows="1"
      columns="1"
      >
      <label loc="165 20" size="25 20"
        style="Label1"
        label="Hz"
        />
      <button loc="15 125" size="155 20"
        style="Heading2"
        label="Update LineList"
        vq="craftpath file cllin"
        vc="if (cllin[1]&lt;-0.5) then craftllbyth(th,vs,cllin[4]) elseif (cllin[1]&gt;0.5) then craftll(cllin[2],cllin[3],cllin[4]) else return endif"
        show="exists('craftpath','parameter'):$P $ENABLE=($P&gt;0.5)*2-1"
        bg="transparent"
        decor1="yes"
        halignment="Center"
        valignment="Center"
        />
      <entry loc="125 20" size="40 20"
        style="PlainText"
        vq="cllin"
        vc="cllin[4]=$VALUE"
        set="$VALUE=cllin[4]"
        digits="1"
        />
      <label loc="30 20" size="95 20"
        style="Label1"
        label="Segment width"
        justify="Left"
        />
      <check loc="5 40" size="170 20"
        style="Info"
        label="Automatic threshold"
        vq="cllin"
        vc="cllin[1]=1"
        vc2="cllin[1]=0"
        set="$VALUE=(cllin[1]&gt;0.5)"
        />
      <entry loc="125 80" size="40 20"
        style="PlainText"
        vq="cllin"
        vc="cllin[3]=$VALUE"
        set="$VALUE=cllin[3]"
        show="$ENABLE=(cllin[1]&gt;0.5)*2-1"
        digits="1"
        />
      <entry loc="125 60" size="40 20"
        style="PlainText"
        vq="cllin"
        vc="cllin[2]=$VALUE"
        set="$VALUE=cllin[2]"
        show="$ENABLE=(cllin[1]&gt;0.5)*2-1"
        digits="0"
        />
      <label loc="15 80" size="105 20"
        style="Label1"
        label="Minimum S/N"
        justify="Right"
        />
      <label loc="15 60" size="105 20"
        style="Label1"
        label="Max. # of peaks"
        justify="Right"
        />
      <check loc="5 100" size="170 20"
        style="Info"
        label="Current threshold"
        vq="cllin"
        vc="cllin[1]=-1"
        vc2="cllin[1]=0"
        set="$VALUE=(cllin[1]&lt;-0.5)"
        />
    </group>
    <group loc="5 160" size="190 90"
      style="Heading1"
      label="CRAFT Analysis"
      border="Etched"
      side="Top"
      justify="Left"
      tab="no"
      enable="no"
      reference="Datamanipulation"
      useref="no"
      subtype="Titled"
      expanded="yes"
      rows="1"
      columns="1"
      >
      <button loc="20 60" size="155 20"
        style="Heading2"
        label="More options.."
        vq="file arraydim procdim craftpath"
        vc="graphis:$ds if $ds&lt;&gt;'ds' then write('error','Display spectrum to CRAFT') else autocraft endif"
        show="$S=0 $submit=0 exists('craft','maclib'):$S is_submitmode:$submit if $S then craft('validate','quiet'):$S endif exists('craftpath','parameter'):$P $ENABLE=(($S&gt;0.5) and ($submit&lt;0.5) and ($P&lt;0.5))*2-1"
        bg="transparent"
        decor1="yes"
        tooltip="CRAFT with more options"
        halignment="Center"
        valignment="Center"
        />
      <button loc="20 40" size="155 20"
        style="Heading2"
        label="Between cursors"
        vq="file arraydim procdim craftpath"
        vc="graphis:$ds if $ds&lt;&gt;'ds' or crmode&lt;&gt;'b' then write('error','Display spectrum with 2 cursors to define region') else autocraft('popup','auto','cursors') endif"
        show="$S=0 $submit=0 exists('craft','maclib'):$S is_submitmode:$submit if $S then craft('validate','quiet'):$S endif exists('craftpath','parameter'):$P $ENABLE=(($S&gt;0.5) and ($submit&lt;0.5) and ($P&lt;0.5))*2-1"
        bg="transparent"
        decor1="yes"
        tooltip="CRAFT between cursors"
        halignment="Center"
        valignment="Center"
        />
      <button loc="20 20" size="155 20"
        style="Heading2"
        label="Displayed region"
        vq="file arraydim procdim craftpath"
        vc="graphis:$ds if $ds&lt;&gt;'ds' then write('error','Display a region to CRAFT') else autocraft('popup','auto','display') endif"
        show="$S=0 $submit=0 exists('craft','maclib'):$S is_submitmode:$submit if $S then craft('validate','quiet'):$S endif exists('craftpath','parameter'):$P $ENABLE=(($S&gt;0.5) and ($submit&lt;0.5) and ($P&lt;0.5))*2-1"
        bg="transparent"
        decor1="yes"
        tooltip="CRAFT current display"
        halignment="Center"
        valignment="Center"
        />
    </group>
    <group loc="200 180" size="190 70"
      style="Heading1"
      label="CRAFT Results"
      border="Etched"
      side="Top"
      justify="Left"
      tab="no"
      enable="no"
      reference="Datamanipulation"
      useref="no"
      subtype="Titled"
      expanded="yes"
      rows="1"
      columns="1"
      >
      <textmessage loc="25 20" size="140 20"
        style="Info"
        label="Size: 14M bytes"
        vq="craftpath"
        set="craftllout('size'):$VALUE"
        />
      <button loc="15 41" size="155 20"
        style="Heading2"
        label="Delete this result"
        vq="file arraydim procdim craftpath"
        vc="craftllout('delete',craftpath) vnmrjcmd('pnew','craftpath')"
        show="exists('craftpath','parameter'):$P $ENABLE=($P&gt;0.5)*2-1"
        bg="transparent"
        decor1="yes"
        halignment="Center"
        valignment="Center"
        />
    </group>
    <group loc="200 5" size="190 175"
      style="Heading1"
      label="CRAFT Display"
      border="Etched"
      side="Top"
      justify="Left"
      tab="no"
      enable="no"
      reference="Datamanipulation"
      useref="no"
      subtype="Titled"
      expanded="yes"
      rows="1"
      columns="1"
      >
      <button loc="15 145" size="155 20"
        style="Heading2"
        label="CRAFT ROIs"
        vq="file arraydim procdim craftpath"
        vc="craft_showBandInfo(craftpath)"
        show="$submit=0 is_submitmode:$submit exists('craftpath','parameter'):$P $ENABLE=(($P&gt;0.5) and ($submit&lt;0.5))*2-1"
        bg="transparent"
        decor1="yes"
        halignment="Center"
        valignment="Center"
        />
      <button loc="15 125" size="155 20"
        style="Heading2"
        label="CRAFT parameters"
        vq="file arraydim procdim craftpath"
        vc="craft('showcraftparams',craftpath)"
        show="$submit=0 is_submitmode:$submit exists('craftpath','parameter'):$P $ENABLE=(($P&gt;0.5) and ($submit&lt;0.5))*2-1"
        bg="transparent"
        decor1="yes"
        halignment="Center"
        valignment="Center"
        />
      <group loc="5 15" size="180 105"
        vq="craftpath"
        border="None"
        tab="no"
        enable="no"
        useref="no"
        subtype="Untitled"
        rows="1"
        columns="1"
        >
        <check loc="0 3" size="180 20"
          style="PlainText"
          label="Linelist models (individual)"
          vq="cllin craftpath"
          vc="craftllout('set',9,1) craftllout('display')"
          vc2="craftllout('set',9,0) craftllout('display')"
          set="craftllout('get',9):$v $VALUE=($v&gt;0.5)"
          show="craftllout('get',9):$v2 $ENABLE=($v2&gt;-0.5)*2-1"
          />
        <check loc="0 23" size="180 20"
          style="PlainText"
          label="Linelist models (sum)"
          vq="cllin craftpath"
          vc="craftllout('set',8,1) craftllout('display')"
          vc2="craftllout('set',8,0) craftllout('display')"
          set="craftllout('get',8):$v $VALUE=($v&gt;0.5)"
          show="craftllout('get',8):$v2 $ENABLE=($v2&gt;-0.5)*2-1"
          />
        <check loc="0 43" size="180 20"
          style="PlainText"
          label="CRAFT residuals"
          vq="cllin craftpath"
          vc="craftllout('set',7,1) craftllout('display')"
          vc2="craftllout('set',7,0) craftllout('display')"
          set="craftllout('get',7):$v $VALUE=($v&gt;0.5)"
          show="craftllout('get',7):$v2 $ENABLE=($v2&gt;-0.5)*2-1"
          />
        <check loc="0 63" size="180 20"
          style="PlainText"
          label="CRAFT models spectrum"
          vq="cllin craftpath"
          vc="craftllout('set',6,1) craftllout('display')"
          vc2="craftllout('set',6,0) craftllout('display')"
          set="craftllout('get',6):$v $VALUE=($v&gt;0.5)"
          show="craftllout('get',6):$v2 $ENABLE=($v2&gt;-0.5)*2-1"
          />
        <check loc="0 83" size="180 20"
          style="PlainText"
          label="Experimental Spectrum"
          vq="cllin craftpath"
          vc="craftllout('set',5,1) craftllout('display')"
          vc2="craftllout('set',5,0) craftllout('display')"
          set="craftllout('get',5):$v $VALUE=($v&gt;0.5)"
          show="craftllout('get',5):$v2 $ENABLE=($v2&gt;-0.5)*2-1"
          />
      </group>
    </group>
    <button loc="400 10" size="340 25"
      style="Heading2"
      label="Display/refresh CRAFT LineList table"
      vq="file arraydim procdim craftpath craftllTable"
      vc="craftllout('text')"
      show="exists('craftpath','parameter'):$P exists('craftllTable','parameter'):$P2 $ENABLE=(($P&gt;0.5) and ($P2&gt;0.5))*2-1"
      bg="transparent"
      decor1="yes"
      halignment="Center"
      valignment="Center"
      />
  </group>
</template>
